@model IEnumerable<Tusimaka.Model.Strekning>

@{
    ViewBag.Title = "FlyruterAdministrer";
}
<script type="text/javascript">
    $(document).ready(function () {
        // lag en hendelse som utføres når en a-href med "data-SletteModal = true" trykkes.
        $('a[data-sletteFlyruterModal=true]').click(function () {

            // hent inn data-taggene fra denne a-hef lenken
            var data_navn = $(this).data('navn');
            var data_id = $(this).data('id');

            // legg ut dataene i div'en i modal-view'et
            $('#slettFlyrute').html(data_navn);

            // lag en hendelse for knappen for å slette via ajax, knappen ligger i modal-view'et
            // må ligge inne i denne overordnede funksjonen for at id'én som er valgt kan brukes
            $("#sletteFlyruteModalKnapp").click(function () {
                // id som skal slettes ligger i data_id
                $.ajax({
                    url: '@Url.Action("slettFlyrute", "Admin")',
                    data: { id: data_id },  // en parameter inn i slett(id)-metoden i kunde-kontrolleren (JSON-objekt)
                    success: function () {
                        console.log("Dette funker - ajax url action slettFlyrute");
                        // må kalle liste-metoden for å vise den nye listen av kunder
                        $.ajax({
                            url: '@Url.Action("FlyruterAdministrer", "Admin")',
                            success: function () {
                                // så må siden reloades!
                                window.location.reload();
                            }
                        });
                        }
                    });
                })
            })
        });
</script>

<h2>FlyruterAdministrer</h2>

<p>
    @Html.ActionLink("Legg til ny flyrute", "RegistrerFlyrute")
</p>
<table class="table">
    <tr>
        <th>
            Fra
        </th>
        <th>
            Til
        </th>
        <th>
            Dato
        </th>
        <th>
            Tid
        </th>
        <th>
            Pris
        </th>
        <th>
            Flytid
        </th>
        <th>
            Ledige seter
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.FraFlyplass)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.TilFlyplass)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Dato)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Tid)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Pris)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.FlyTid)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.AntallLedigeSeter)
        </td>
        <td>
            @Html.ActionLink("Edit", "EndreFlyrute", new { id=item.StrekningsID }) |
            @Html.ActionLink("Details", "Details", new { id=item.StrekningsID }) |
            <a href="#sletteFlyruterModal" class="btn btn-large btn-danger" id="sletteKnapp"
               data-navn="@item.FraFlyplass @item.TilFlyplass @item.Dato @item.Tid @item.Pris @item.FlyTid @item.AntallLedigeSeter"
               data-id="@item.StrekningsID" data-toggle="modal" data-sletteFlyruterModal="true">Slett</a>
        </td>
    </tr>
}

</table>
@Html.Partial("SlettFlyruterModal")
